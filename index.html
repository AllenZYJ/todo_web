

<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
@media (max-width: 768px) {
    .container {
        margin: 30px 20px;
        padding: 15px;
    }
    h1 {
        font-size: 1.5rem;
    }
    #add-todo {
        flex-direction: row;
        margin-bottom: 1rem;
    }
    #todo-input {
        flex-grow: 1;
    }
    #submit-button {
        margin-top: 0;
        margin-left: 1rem;
    }
    .tabs {
        flex-direction: column;
    }
    .tab {
        margin-bottom: 10px;
    }
}

@media (max-width: 480px) {
    h1 {
        font-size: 1.2rem;
    }
    #add-todo {
        flex-direction: row;
    }
    #todo-input {
        font-size: 0.9rem;
    }
    #submit-button {
        font-size: 0.9rem;
    }
    .tab {
        font-size: 0.9rem;
    }
}


        body {
            font-family: 'Roboto', Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 600px;
            margin: 50px auto;
            background-color: #ffffff;
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
        }
        h1 {
            text-align: center;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }
        #add-todo {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        #todo-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            outline: none;
            font-size: 1rem;
        }
        #submit-button {
            background-color: #4CAF50;
            border: none;
            color: white;
            padding: 0.5rem 1.5rem;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1rem;
            margin-left: 1rem;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        #submit-button:hover {
            background-color: #3d8b40;
        }
        ul {
            padding: 0;
        }
        li {
            list-style-type: none;
            border-bottom: 1px solid #ddd;
            padding: 12px;
            display: flex;
            align-items: center;
        }
        input[type="checkbox"] {
            margin-right: 12px;
        }
        .tabs {
            display: flex;
            margin-bottom: 24px;
        }
        .tab {
            flex-grow: 1;
            text-align: center;
            background-color: #f1f1f1;
            padding: 12px 0;
            cursor: pointer;
            font-size: 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        .tab:not(.active):hover {
            background-color: #ddd;
        }
        .active {
            background-color: #4CAF50;
            color: white;
        }
        .accordion {
        background-color: transparent;
        color: #444;
        cursor: pointer;
        width: 100%;
        border: none;
        text-align: left;
        outline: none;
        font-size: 15px;
        transition: 0.4s;
    }
        .accordion-header {
            font-weight: bold;
            border-radius: 4px 4px 0 0;
            padding: 18px;
        }
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.2s ease-out;
            background-color: transparent;
            border-radius: 0 0 4px 4px;
        }


        .accordion-content ul {
            margin: 0;
            padding: 0;
        }

        .accordion-content li {
            list-style-type: none;
            border-bottom: 1px solid #ddd;
            padding: 12px;
            display: flex;
            align-items: center;
        }
        .accordion-content.show {
            max-height: 1000px;
        }
        .delete-button {
            background-color: #f44336;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin-left: auto;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .delete-all-button {
            background-color: #f44336;
            border: none;
            color: white;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin-left: auto;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .delete-all-button:hover {
            background-color: #da1e0a;
        }
            </style>
            </head>
            <body>
            <div class="container">
            <h1>Todo List</h1>
            <div id="add-todo">
            <input type="text" id="todo-input" placeholder="请输入待办事项...">
            <button id="submit-button">+</button>
            </div>
            <div class="tabs">
            <div id="tab-todo" class="tab active">待办事项</div>
            <div id="tab-done" class="tab">已完成</div>
            </div>
            <ul id="todo-list"></ul>
            </div>
            <script>
                const todoInput = document.getElementById('todo-input');
                const submitButton = document.getElementById('submit-button');
                const todoList = document.getElementById('todo-list');
                const tabTodo = document.getElementById('tab-todo');
                const tabDone = document.getElementById('tab-done');
                const apiUrl = 'http://8.130.73.40:2170'
                todoInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                addTodo();
                    }
                });



                function addTodo() {
                    const todoText = todoInput.value.trim();
                    if (todoText) {
                        fetch(`${apiUrl}/todos`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ text: todoText, done: false, date: new Date().toISOString() })
                        }).then(res => res.json()).then(() => {
                            todoInput.value = '';
                            updateTodoList();
                        });
                    }
                }
                let currentTab = 'todo';
                tabTodo.addEventListener('click', () => {
                    currentTab = 'todo';
                    tabTodo.classList.add('active');
                    tabDone.classList.remove('active');
                    updateTodoList();
                });
                
                tabDone.addEventListener('click', () => {
                    currentTab = 'done';
                    tabTodo.classList.remove('active');
                    tabDone.classList.add('active');
                    updateTodoList();
                });
                
                submitButton.addEventListener('click', () => {
                    const todoText = todoInput.value.trim();
                    if (todoText) {
                        fetch(`${apiUrl}/todos`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ text: todoText, done: false, date: new Date().toISOString() })
                        }).then(res => res.json()).then(updateTodoList);
                    }
                });
                function groupByDate(todos) {
                const grouped = {};
                todos.forEach(todo => {
                    const date = new Date(todo.date).toLocaleDateString();
                    if (!grouped[date]) {
                        grouped[date] = [];
                    }
                    grouped[date].push(todo);
                });

                // 按日期排序
                const sortedDates = Object.keys(grouped).sort((a, b) => {
                    const dateA = new Date(a);
                    const dateB = new Date(b);
                    return dateA - dateB;
                });

                const sortedGrouped = {};
                sortedDates.forEach(date => {
                    sortedGrouped[date] = grouped[date];
                });

                return sortedGrouped;
            }
            function createAccordionItem(date, todos) {
                return `
                    <div class="accordion">
                        <div class="accordion-header">
                            ${date}
                            <button class="delete-all-button" data-date="${date}">删除全部</button>
                        </div>
                        <div class="accordion-content">
                            <ul>
                                ${todos.map((todo, index) => `
                                    <li>
                                        <input type="checkbox" ${todo.done ? 'checked' : ''} data-index="${todo.index}">
                                        ${todo.text}
                                        <button class="delete-button" data-index="${todo.index}">删除</button>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }


                
                async function updateTodoList() {
                    const res = await fetch(`${apiUrl}/todos`);
                    const data = await res.json();
                    const filteredTodos = data.todos.map((todo, index) => ({ ...todo, index })).filter(todo => todo.done === (currentTab === 'done'));
                    const groupedTodos = groupByDate(filteredTodos);
                    todoList.innerHTML = Object.entries(groupedTodos).map(([date, todos]) => createAccordionItem(date, todos)).join('');

                    const accordionHeaders = document.querySelectorAll('.accordion-header');
                    accordionHeaders.forEach(header => {
                        header.addEventListener('click', () => {
                            const content = header.nextElementSibling;
                            if (content.style.maxHeight) {
                                content.style.maxHeight = null;
                                content.style.padding = null;
                                content.style.boxShadow = null;
                            } else {
                                content.style.maxHeight = content.scrollHeight + 'px';
                                content.style.padding = '18px';
                                content.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)';
                            }
                        });
                    });

                    
                    const checkboxes = document.querySelectorAll('#todo-list input[type="checkbox"]');
                    checkboxes.forEach(checkbox => {
                        checkbox.addEventListener('change', async (e) => {
                            const index = parseInt(e.target.getAttribute('data-index'), 10);
                            const updatedTodo = { ...data.todos[index], done: e.target.checked };
                            const response = await fetch(`${apiUrl}/todos/${index}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(updatedTodo)
                            });
                            if (response.ok) {
                                updateTodoList();
                            }
                        });
                    });
                    const deleteButtons = document.querySelectorAll('.delete-button');
                    deleteButtons.forEach(button => {
                        button.addEventListener('click', async (e) => {
                            const index = parseInt(e.target.getAttribute('data-index'), 10);
                            if (confirm('确定要删除这个事项吗？')) {
                                const response = await fetch(`${apiUrl}/todos/${index}`, {
                                    method: 'DELETE'
                                });
                                if (response.ok) {
                                    updateTodoList();
                                }
                            }
                        });
                    });
                    const deleteAllButtons = document.querySelectorAll('.delete-all-button');


                    deleteAllButtons.forEach(button => {
                        button.addEventListener('click', async (e) => {
                            const date = e.target.getAttribute('data-date');
                            if (confirm(`确定要删除 ${date} 的所有事项吗？`)) {
                                const formattedDate = new Date(date).toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '-');
                                const response = await fetch(`${apiUrl}/todos/delete_all/${formattedDate}`, {
                                    method: 'DELETE'
                                });
                                if (response.ok) {
                                    updateTodoList();
                                }
                            }
                        });
                    });

                }
                document.addEventListener('DOMContentLoaded', () => {
                    updateTodoList();
                });
                </script>
            </body>
            </html>
